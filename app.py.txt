import firebase_admin
from firebase_admin import credentials
import json
import os

# Ø§Ù‚Ø±Ø£ Ø§Ù„Ù€ JSON Ù…Ù† Ù…ØªØºÙŠØ± Ø§Ù„Ø¨ÙŠØ¦Ø©
firebase_json = os.environ.get("FIREBASE_CREDENTIALS")

# Ø­ÙˆÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ dict
cred_dict = json.loads(firebase_json)

# ÙØ¹Ù‘Ù„ Firebase
cred = credentials.Certificate(cred_dict)
firebase_admin.initialize_app(cred)

db = firestore.client()

st.set_page_config(page_title="Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø¯ÙˆØ§Ø¬Ù†", page_icon="ğŸ”")
st.title("ğŸ” Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø¯ÙˆØ§Ø¬Ù†")

# ÙÙˆØ±Ù… Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø²Ø±Ø¹Ø©
with st.form("farm_form"):
    name = st.text_input("Ø§Ø³Ù… Ø§Ù„Ù…Ø²Ø±Ø¹Ø©")
    weight = st.number_input("Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ (ÙƒØºÙ…)", min_value=0.0)
    health_status = st.selectbox("Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµØ­ÙŠØ©", ["Ø¬ÙŠØ¯Ø©", "Ù…ØªÙˆØ³Ø·Ø©", "Ø­Ø±Ø¬Ø©"])
    lab_results = st.text_area("Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„")
    report = st.text_area("Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØµØ­ÙŠ")

    submit = st.form_submit_button("Ø¥Ø±Ø³Ø§Ù„ âœ…")
    if submit:
        db.collection("poultry_farms").add({
            "name": name,
            "weight": weight,
            "health_status": health_status,
            "lab_results": lab_results,
            "report": report
        })
        st.success("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!")

# Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø²Ø§Ø±Ø¹
st.subheader("ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø²Ø§Ø±Ø¹")
docs = db.collection("poultry_farms").stream()
for doc in docs:
    d = doc.to_dict()
    st.write(f"ğŸ·ï¸ Ø§Ù„Ø§Ø³Ù…: {d['name']}")
    st.write(f"âš–ï¸ Ø§Ù„ÙˆØ²Ù†: {d['weight']} ÙƒØºÙ…")
    st.write(f"ğŸ’Š Ø§Ù„Ø­Ø§Ù„Ø©: {d['health_status']}")
    st.write(f"ğŸ§ª Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„: {d['lab_results']}")
    st.write(f"ğŸ“ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: {d['report']}")
    st.markdown("---")